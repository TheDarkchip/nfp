{"id":"nfp-0cc","title":"Minimize module exposures after refactor","description":"Review Nfp module imports and @[expose] usage to minimize public scope while keeping proofs intact; reduce public imports where not required.","status":"closed","priority":2,"issue_type":"task","owner":"robin.gieseke@me.com","created_at":"2026-01-13T19:34:26.46573+01:00","created_by":"TheDarkchip","updated_at":"2026-01-13T20:34:08.660625+01:00","closed_at":"2026-01-13T20:34:08.660625+01:00","close_reason":"Closed","comments":[{"id":19,"issue_id":"nfp-0cc","author":"TheDarkchip","text":"Starting exposure/public-import minimization pass (focus: Model then Circuit).","created_at":"2026-01-13T18:38:59Z"},{"id":20,"issue_id":"nfp-0cc","author":"TheDarkchip","text":"Reduced exposure in Nfp/Model and Nfp/Circuit: switched to public section, then selectively re-exposed needed defs (linearRank, attention* core defs, Interface/TypedCircuit evals, InductionSpecApproxOn) and made SameInterface decidable instance private. Builds: lake build --wfail, lake build nfp --wfail.","created_at":"2026-01-13T18:49:21Z"},{"id":21,"issue_id":"nfp-0cc","author":"TheDarkchip","text":"Minimized exposures in Sound by replacing simp-on-def with public def-lemmas (using simp proofs) for ln/q/k/scores/headValue/headOutput and new dirHeadVecOfInputs_get. Added Batteries Vector lemmas import for ofFn/get, and only exposed buildInductionHeadCoreCacheWith to keep CoreSound proof definitional. Updated CoreSound/HeadOutput/LogitDiff to use *_def lemmas. lake build --wfail and lake build nfp --wfail pass.","created_at":"2026-01-13T19:20:09Z"},{"id":22,"issue_id":"nfp-0cc","author":"TheDarkchip","text":"Further reduced exposures: removed @[expose] from buildInductionHeadInputs, vRealOfInputs/valsRealOfInputs, sumFinCommonDen, dotFin; replaced rfl def-lemmas with simp proofs and updated CoreSound/HeadOutput/LogitDiff to use *_def lemmas. Remaining exposed def: buildInductionHeadCoreCacheWith (needed for definitional alignment in CoreSound). lake build --wfail and lake build nfp --wfail pass.","created_at":"2026-01-13T19:34:05Z"},{"id":23,"issue_id":"nfp-0cc","author":"TheDarkchip","text":"Removed final @[expose] in Sound by switching CoreSound/Basic to import all Nfp.Sound.Induction.Core.Basic (module-system guidance for unfolding private defs in lemma modules). buildInductionHeadCoreCacheWith is now unexposed; all Sound exposures eliminated. Builds: lake build --wfail, lake build nfp --wfail.","created_at":"2026-01-13T19:49:31Z"}]}
{"id":"nfp-1gd","title":"Align claims and soundness limitations with induction certification audit","description":"Update CLAIMS.md and SOUNDNESS_LIMITATIONS.md to reflect conditional head-level certification and updated CLI names.","status":"closed","priority":2,"issue_type":"task","owner":"robin.gieseke@me.com","created_at":"2026-01-13T08:13:22.727618+01:00","created_by":"TheDarkchip","updated_at":"2026-01-13T08:13:41.983105+01:00","closed_at":"2026-01-13T08:13:41.983105+01:00","close_reason":"Closed"}
{"id":"nfp-1mx","title":"Investigate bounded-precision Rat rounding for induction cert speed","description":"Implement non-identity ratRoundDown/ratRoundUp (or local rounding) to control denominator growth while preserving bounds; measure impact on induction-head certification runtime.","status":"open","priority":2,"issue_type":"task","owner":"robin.gieseke@me.com","created_at":"2026-01-13T04:06:14.596939+01:00","created_by":"TheDarkchip","updated_at":"2026-01-13T04:06:14.596939+01:00","comments":[{"id":3,"issue_id":"nfp-1mx","author":"TheDarkchip","text":"Decision: keep full-precision Rat bounds for now; no bounded-precision rounding changes planned until further evidence.","created_at":"2026-01-13T06:51:29Z"}]}
{"id":"nfp-2cr","title":"Improve GPT-2 induction logit-diff bounds","description":" fails with logitDiffLB -2255815196141/250000250000 below min 0. Need improved value-range bounds or direction data to make logit-diff non-vacuous for canonical head.","status":"open","priority":2,"issue_type":"task","owner":"robin.gieseke@me.com","created_at":"2026-01-13T17:04:39.844935+01:00","created_by":"TheDarkchip","updated_at":"2026-01-13T17:04:39.844935+01:00","labels":["bug"],"comments":[{"id":13,"issue_id":"nfp-2cr","author":"TheDarkchip","text":"Starting work on improving logit-diff bounds / direction handling for GPT-2 induction cert.","created_at":"2026-01-13T16:23:08Z"},{"id":14,"issue_id":"nfp-2cr","author":"TheDarkchip","text":"Work interrupted; investigation and proof changes need to be started anew (pending per-query value cert + logit-diff bounds).","created_at":"2026-01-13T16:54:34Z"}]}
{"id":"nfp-35g","title":"Verify prev mapping corresponds to induction pattern","description":"Add a proof/verified derivation that prev indices align with the intended prefix-matching induction pattern for a given token sequence, or surface it as an explicit external assumption in certificates.","status":"closed","priority":2,"issue_type":"task","owner":"robin.gieseke@me.com","created_at":"2026-01-13T08:09:29.898676+01:00","created_by":"TheDarkchip","updated_at":"2026-01-13T09:28:30.277766+01:00","closed_at":"2026-01-13T09:28:30.277766+01:00","close_reason":"Closed","comments":[{"id":4,"issue_id":"nfp-35g","author":"TheDarkchip","text":"Added prevOfTokens_spec_of_active lemma in Nfp/Model/InductionPrompt.lean; build passes.","created_at":"2026-01-13T07:25:58Z"},{"id":5,"issue_id":"nfp-35g","author":"TheDarkchip","text":"Added buildInductionHeadInputs_prev_spec_of_active in Nfp/IO/NfptPure.lean (using prevOfTokens_spec_of_active) so model-derived prev is the maximal prior match when period?=none; docs updated.","created_at":"2026-01-13T08:28:27Z"}]}
{"id":"nfp-3cw","title":"Centralize softmax weight invariants in induction stack","description":"## Context\n- The induction-head stack repeatedly re-proves softmax weight nonnegativity and sum-to-one.\n- Examples include: `Nfp/Sound/Induction/OneHot.lean`, `Nfp/Sound/Induction/CoreSound/Basic.lean`,\n  `Nfp/Sound/Bounds/Attention.lean`, and `Nfp/Sound/Induction/LogitDiff.lean`.\n- The existing `Nfp/Prob` + `Nfp/Mixer` formalization is currently unused downstream.\n\n## Problem\n- Proof obligations for `softmax_nonneg` and `softmax_sum_one` are duplicated across multiple modules.\n- This increases proof size, makes invariants harder to see, and raises maintenance cost.\n\n## Goal\n- Centralize the \"softmax yields a probability vector\" facts (nonneg + sum-to-one) so downstream\n  proofs can reuse them without repeating the same boilerplate.\n\n## Scope / Proposed Approach\n- Introduce a small wrapper structure (e.g., `SoftmaxWeights` or `ProbVecReal`) that packages:\n  - `weights : Fin seq -\u003e Fin seq -\u003e Real`\n  - `nonneg : forall q k, 0 \u003c= weights q k`\n  - `sum_one : forall q, (sum k, weights q k) = 1`\n- Add a lemma that constructs the wrapper from `Circuit.softmax` with a short docstring.\n- Update induction-head proofs to consume the wrapper instead of re-proving nonneg/sum-one locally.\n  Target files:\n  - `Nfp/Sound/Induction/OneHot.lean`\n  - `Nfp/Sound/Induction/CoreSound/Basic.lean`\n  - `Nfp/Sound/Bounds/Attention.lean`\n  - `Nfp/Sound/Induction/LogitDiff.lean`\n- Optionally evaluate whether `Nfp.Prob.ProbVec` can be generalized to Real; if the NNReal\n  mismatch is too invasive, keep the wrapper separate for now and document the tradeoff.\n\n## Acceptance Criteria\n- A new wrapper + constructor lemma exists with docstrings and no linter disables.\n- The target files no longer re-prove `Circuit.softmax_nonneg` and `Circuit.softmax_sum_one` locally;\n  they use the wrapper instead.\n- `lake build --wfail` succeeds.\n- No new axioms are introduced.\n\n## Risks / Notes\n- `ProbVec` is NNReal-based while softmax outputs Real; bridging may require a new structure or\n  a carefully scoped coercion. Avoid global simp rule growth.\n","acceptance_criteria":"- Wrapper + constructor lemma with docstrings added\n- Target induction/attention modules reuse wrapper (no local softmax nonneg/sum-one proofs)\n- `lake build --wfail` passes\n- No new axioms or linter disables","status":"closed","priority":2,"issue_type":"task","assignee":"TheDarkchip","owner":"robin.gieseke@me.com","created_at":"2026-01-14T01:21:43.85933+01:00","created_by":"TheDarkchip","updated_at":"2026-01-14T01:40:34.732005+01:00","closed_at":"2026-01-14T01:40:34.732005+01:00","close_reason":"completed","comments":[{"id":26,"issue_id":"nfp-3cw","author":"TheDarkchip","text":"Implemented Circuit.SoftmaxWeights wrapper + softmaxWeights constructor and softmaxWeights_weights lemma. Refactored OneHot, CoreSound/Basic, and Bounds/Attention to use wrapper for nonneg/sum_one (no local softmax_nonneg/sum_one). lake build --wfail succeeded.","created_at":"2026-01-14T00:39:46Z"}]}
{"id":"nfp-4y8","title":"Refactor parallel reductions to sequential core with equivalence lemmas","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-13T01:42:58.138743+01:00","updated_at":"2026-01-13T04:06:02.594691+01:00","closed_at":"2026-01-13T04:06:02.594691+01:00","close_reason":"Closed"}
{"id":"nfp-5gn","title":"Refactor module structure across repo to mathlib-style headers/imports","description":"Migrate all Lean files away from experimental module headers and public imports/sections; align import structure with mathlib-style source files.","status":"closed","priority":2,"issue_type":"task","assignee":"TheDarkchip","owner":"robin.gieseke@me.com","created_at":"2026-01-14T00:34:55.171544+01:00","created_by":"TheDarkchip","updated_at":"2026-01-14T00:59:02.052937+01:00","closed_at":"2026-01-14T00:59:02.052937+01:00","close_reason":"Closed","labels":["refactor"],"comments":[{"id":24,"issue_id":"nfp-5gn","author":"TheDarkchip","text":"Added mathlib module structure style guide to AGENTS.md; full repo refactor still pending.","created_at":"2026-01-13T23:41:15Z"},{"id":25,"issue_id":"nfp-5gn","author":"TheDarkchip","text":"Rescanned local mathlib: module headers in all .lean files; public import common but not universal; public section often with @[expose], plus public meta/noncomputable sections and rare import all. Updated AGENTS.md style guide accordingly.","created_at":"2026-01-13T23:45:41Z"}]}
{"id":"nfp-96w","title":"Tighten induction-head bounds for nonvacuous certification","description":"Upgrade per-query epsilon bounds to reduce vacuity in certify_head_model_nonvacuous.","status":"closed","priority":2,"issue_type":"task","owner":"robin.gieseke@me.com","created_at":"2026-01-12T16:51:54.831367+01:00","created_by":"TheDarkchip","updated_at":"2026-01-12T17:12:14.022297+01:00","closed_at":"2026-01-12T17:12:14.022297+01:00","close_reason":"Implemented per-key epsilon bounds and proof updates; builds pass."}
{"id":"nfp-dep","title":"Prove/log derivation for logit-diff direction vector","description":"Add a verified link from DirectionSpec (target/negative ids) to the actual unembedding direction used in certification, or explicitly verify the direction vector against model weights.","status":"closed","priority":2,"issue_type":"task","owner":"robin.gieseke@me.com","created_at":"2026-01-13T08:09:25.330985+01:00","created_by":"TheDarkchip","updated_at":"2026-01-13T09:28:40.824036+01:00","closed_at":"2026-01-13T09:28:40.824036+01:00","close_reason":"Closed","comments":[{"id":6,"issue_id":"nfp-dep","author":"TheDarkchip","text":"Added buildInductionHeadInputs_def/buildInductionHeadInputs_direction_def in Nfp/IO/NfptPure.lean: directionSpec matches target/negative ids and direction is colTarget-colNegative from unembedding columns. Docs now note the remaining assumption that unembedding represents logits.","created_at":"2026-01-13T08:28:36Z"}]}
{"id":"nfp-e53","title":"Refactor and optimize module structure","description":"Create a dedicated branch and plan for Lean module/import refactor guided by the Lean manual.","notes":"Pilot module-system conversion for Core/Prob/Mixer/System: added module headers, public sections, public imports for used deps; enabled experimental.module in lakefile.toml and adjusted imports accordingly.","status":"closed","priority":2,"issue_type":"task","assignee":"TheDarkchip","owner":"robin.gieseke@me.com","created_at":"2026-01-13T17:57:19.507102+01:00","created_by":"TheDarkchip","updated_at":"2026-01-13T19:34:39.270845+01:00","closed_at":"2026-01-13T19:34:39.270845+01:00","close_reason":"Closed","comments":[{"id":15,"issue_id":"nfp-e53","author":"TheDarkchip","text":"Converted Nfp/Circuit and Nfp/Model trees to module system: added module headers, public imports, @[expose] public section on definition files, and public-import aggregators. lake build --wfail passes.","created_at":"2026-01-13T18:16:45Z"},{"id":16,"issue_id":"nfp-e53","author":"TheDarkchip","text":"Converted Nfp/Sound and Nfp/IO trees (and Nfp.lean) to module system with public imports; adjusted aggregator modules to avoid empty public sections. Fixed module-system visibility by switching HeadBounds/Basic and Bounds/Transformer/Embedding to public section and making internal spec lemmas private. lake build --wfail passes.","created_at":"2026-01-13T18:27:02Z"},{"id":17,"issue_id":"nfp-e53","author":"TheDarkchip","text":"Switched Nfp/IO modules to public section (no expose) and made IO spec/unfold lemmas private (HeadScore, NfptPure, InductionHead.Bytes). lake build nfp --wfail now passes.","created_at":"2026-01-13T18:32:50Z"},{"id":18,"issue_id":"nfp-e53","author":"TheDarkchip","text":"Converted top-level aggregator modules (Nfp.Circuit/IO/Model/Sound) to module headers with public imports; lake build --wfail rechecked.","created_at":"2026-01-13T18:34:04Z"}]}
{"id":"nfp-ete","title":"Evaluate nonvacuous induction certification on real models","description":"Run certify_head_model_nonvacuous on GPT-2/GPT2-small binaries; if still vacuous, explore tighter value-range bounds (per-query or mask-aware).","notes":"Investigating nonvacuous induction head certification","status":"closed","priority":2,"issue_type":"task","owner":"robin.gieseke@me.com","created_at":"2026-01-12T17:11:56.642685+01:00","created_by":"TheDarkchip","updated_at":"2026-01-12T23:28:32.804466+01:00","closed_at":"2026-01-12T23:28:32.804466+01:00","close_reason":"Closed","comments":[{"id":2,"issue_id":"nfp-ete","author":"TheDarkchip","text":"Fixed f64-\u003eRat conversion: use signed exponent in NfptPure.ratOfFloatBits. Lean model reads now match head inputs; certify_head_model_nonvacuous succeeds (build ~370s, logit diff fast).","created_at":"2026-01-12T22:28:26Z"}]}
{"id":"nfp-g0j","title":"Refactor HeadBounds reduction helpers","description":"Deduplicate chunked reduction task helpers in Nfp/Sound/Induction/HeadBounds.lean to reduce proof churn while preserving behavior.","status":"closed","priority":2,"issue_type":"task","owner":"robin.gieseke@me.com","created_at":"2026-01-12T16:21:11.583135+01:00","created_by":"TheDarkchip","updated_at":"2026-01-12T16:22:20.621327+01:00","closed_at":"2026-01-12T16:22:20.621327+01:00","close_reason":"Completed"}
{"id":"nfp-g78","title":"Refactor CoreSound lemmas for stability","description":"Refactor Nfp/Sound/Induction/CoreSound.lean to reduce proof churn and improve maintainability; keep proofs explicit and stable.","status":"closed","priority":2,"issue_type":"task","owner":"robin.gieseke@me.com","created_at":"2026-01-12T16:12:25.347409+01:00","created_by":"TheDarkchip","updated_at":"2026-01-12T16:16:04.322186+01:00","closed_at":"2026-01-12T16:16:04.322186+01:00","close_reason":"Completed","labels":["in_progress"]}
{"id":"nfp-giz","title":"Remove remaining @[expose] and add def lemmas for module system","description":"Drop remaining expose attributes, add explicit def lemmas, and update simp uses to match mathlib-style module boundaries.","status":"closed","priority":2,"issue_type":"task","owner":"robin.gieseke@me.com","created_at":"2026-01-13T21:36:36.153438+01:00","created_by":"TheDarkchip","updated_at":"2026-01-13T22:23:45.005299+01:00","closed_at":"2026-01-13T22:23:45.005299+01:00","close_reason":"Closed","labels":["refactor"]}
{"id":"nfp-mzt","title":"Bridge head-level induction certificates to block/model logits","description":"Add formal bridge theorems from head-level certificates (attention + value + logit-diff bounds) to block-level or end-to-end model logit bounds.","status":"open","priority":2,"issue_type":"task","owner":"robin.gieseke@me.com","created_at":"2026-01-13T08:09:33.475601+01:00","created_by":"TheDarkchip","updated_at":"2026-01-13T08:09:33.475601+01:00","comments":[{"id":7,"issue_id":"nfp-mzt","author":"TheDarkchip","text":"Added bridge lemmas in LogitDiff.lean: headLogitDiff_eq_direction_dot_headOutput and logitDiffLowerBound_with_residual (compose head logit-diff bound with residual interval bounds). Updated CLAIMS.md and docs/induction_cert_audit.md to reflect the partial bridge; full end-to-end model semantics still open.","created_at":"2026-01-13T11:18:45Z"},{"id":8,"issue_id":"nfp-mzt","author":"TheDarkchip","text":"Added gpt2ResidualIntervalBoundsActive_sound in Sound/Bounds/Transformer.lean to package GPT-2 residual bounds into a ResidualIntervalCert with ResidualIntervalBounds + output_mem for transformerStackFinalReal (requires hne/heps/hsqrt). Updated CLAIMS.md and docs/induction_cert_audit.md accordingly. Next gap: connect head-level logit-diff contribution through the stack (residual is not just additive after LN/MLP).","created_at":"2026-01-13T11:31:05Z"},{"id":9,"issue_id":"nfp-mzt","author":"TheDarkchip","text":"Added logitDiffLowerBound_with_output_intervals in Sound/Induction/LogitDiff.lean: combines head logit-diff LB with head-output intervals and downstream output intervals via interval subtraction (residual = output - headOutput). Updated CLAIMS.md, docs/induction_cert_audit.md, SOUNDNESS_LIMITATIONS.md to reflect this partial bridge.","created_at":"2026-01-13T11:42:26Z"},{"id":10,"issue_id":"nfp-mzt","author":"TheDarkchip","text":"Added EndToEnd.lean with logitDiffLowerBound_end_to_end_gpt2: instantiates logitDiffLowerBound_with_output_intervals using HeadOutputIntervalSound and gpt2ResidualIntervalBoundsActive_sound to bound directionÂ·transformerStackFinalReal. Updated Induction aggregator and MODULE_MAP. Build clean.","created_at":"2026-01-13T11:49:54Z"},{"id":11,"issue_id":"nfp-mzt","author":"TheDarkchip","text":"Wired nfp induction certify_end_to_end_model to optionally derive head-output interval bounds when --layer/--head are provided (with optional --period). CLI now computes interval-composed bound via head output intervals and residual intervals, reports intervalLB/effectiveLB, and keeps base downstream bound as fallback.","created_at":"2026-01-13T12:21:53Z"}]}
{"id":"nfp-osv","title":"Expose split-budget knobs for induction head certification","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-13T00:52:32.742247+01:00","updated_at":"2026-01-13T01:11:40.876901+01:00","closed_at":"2026-01-13T01:11:40.876901+01:00","close_reason":"Closed"}
{"id":"nfp-pgc","title":"Merge refactor/module-structure-nfp-e53 into audit-induction-cert","status":"in_progress","priority":2,"issue_type":"task","created_at":"2026-01-14T01:47:18.190665+01:00","updated_at":"2026-01-14T01:47:27.049688+01:00"}
{"id":"nfp-snh","title":"Refactor MatrixNorm interval bounds proofs","description":"Refactor Nfp/Sound/Bounds/MatrixNorm/Interval.lean to reduce proof churn and simplify interval bound lemmas.","status":"closed","priority":2,"issue_type":"task","owner":"robin.gieseke@me.com","created_at":"2026-01-12T15:54:50.752468+01:00","created_by":"TheDarkchip","updated_at":"2026-01-12T16:01:12.070535+01:00","closed_at":"2026-01-12T16:01:12.070535+01:00","close_reason":"Closed","comments":[{"id":1,"issue_id":"nfp-snh","author":"TheDarkchip","text":"Refactored foldl_pair helper for pair foldl projections in MatrixNorm interval bounds; adjusted proofs to use Prod.fst/Prod.snd. Fixed CoreSound cdot lint warnings encountered during build.","created_at":"2026-01-12T15:01:08Z"}]}
{"id":"nfp-x8g","title":"Streamline CLI options and induction certification UX","description":"Reduce option surface area, add presets/shortcuts, and improve defaults for induction certification commands without losing advanced configurability.","status":"closed","priority":2,"issue_type":"task","owner":"robin.gieseke@me.com","created_at":"2026-01-13T07:53:31.417957+01:00","created_by":"TheDarkchip","updated_at":"2026-01-13T08:00:52.123717+01:00","closed_at":"2026-01-13T08:00:52.123717+01:00","close_reason":"Closed"}
{"id":"nfp-xh8","title":"Fix stack overflow when certifying GPT-2 induction certs","description":"Stack overflow when running induction certification on seq=256 GPT-2 certs. Repro: generate softmax/value certs via scripts/build_gpt2_induction_cert_from_binary.py on /Users/robin/Uni/iml/gpt2_rigorous.nfpt (layer 5 head 1, target 2835, negative 4236). Then run lake exe nfp induction advanced certify with those files; crash with stack overflow. End-to-end model path also crashes even with dummy residual interval. Suspect checkSoftmaxMarginCert / finset recursion; consider loop/array-based checks.","status":"closed","priority":2,"issue_type":"task","owner":"robin.gieseke@me.com","created_at":"2026-01-13T16:19:57.127206+01:00","created_by":"TheDarkchip","updated_at":"2026-01-13T16:59:56.811923+01:00","closed_at":"2026-01-13T16:59:56.811923+01:00","close_reason":"Stack overflow resolved by array-backed parse state; GPT-2 cert check runs.","labels":["bug"],"comments":[{"id":12,"issue_id":"nfp-xh8","author":"TheDarkchip","text":"Switched SoftmaxMargin ParseState matrices from nested function updates to Array-of-Array storage and use Array.all in finalize; lookup now uses array indexing. Stack overflow gone: ok: softmax-margin certificate accepted (seq=256, active=2) succeeds. With values: fails on negative logitDiffLB (no crash).","created_at":"2026-01-13T15:59:38Z"}]}
{"id":"nfp-z1j","title":"Audit induction-head certification soundness claim","description":"Review proof chain for induction-head certification and document scope/limitations with mechinterp framing.","status":"closed","priority":2,"issue_type":"task","owner":"robin.gieseke@me.com","created_at":"2026-01-13T08:09:10.323741+01:00","created_by":"TheDarkchip","updated_at":"2026-01-13T08:10:29.361118+01:00","closed_at":"2026-01-13T08:10:29.361118+01:00","close_reason":"Closed"}
